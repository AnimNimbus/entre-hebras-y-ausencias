<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.1.4/dist/mindar-image-aframe.prod.js"></script>
    <style>
      body { margin: 0; overflow: hidden; }
      #instruction {
        position: absolute;
        top: 10px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 22px;
        font-weight: bold;
        color: white;
        background: rgba(0,0,0,0.6);
        padding: 10px 20px;
        border-radius: 10px;
        z-index: 9999;
      }
    </style>
  </head>
  <body>
    <!-- Texto de instrucción -->
    <div id="instruction">Junta los 3 cuadros</div>

    <!-- Escena AR -->
    <a-scene
      mindar-image="imageTargetSrc: ./targets/cuadros.mind;"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: true"
      embedded
    >
      <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

      <!-- Targets individuales -->
      <a-entity mindar-image-target="targetIndex: 0" id="target-victima"></a-entity>
      <a-entity mindar-image-target="targetIndex: 1" id="target-testigo"></a-entity>
      <a-entity mindar-image-target="targetIndex: 2" id="target-agresor"></a-entity>
    </a-scene>

    <script>
      const victima = document.querySelector("#target-victima");
      const testigo = document.querySelector("#target-testigo");
      const agresor = document.querySelector("#target-agresor");
      const instruction = document.getElementById("instruction");

      let seenVictima = false;
      let seenTestigo = false;
      let seenAgresor = false;

      // Detectar aparición de cada target
      victima.addEventListener("targetFound", () => { seenVictima = true; checkAll(); });
      testigo.addEventListener("targetFound", () => { seenTestigo = true; checkAll(); });
      agresor.addEventListener("targetFound", () => { seenAgresor = true; checkAll(); });

      // Detectar cuando se pierden
      victima.addEventListener("targetLost", () => { seenVictima = false; });
      testigo.addEventListener("targetLost", () => { seenTestigo = false; });
      agresor.addEventListener("targetLost", () => { seenAgresor = false; });

      function checkAll() {
        if (seenVictima && seenTestigo && seenAgresor) {
          instruction.textContent = "¡Activado!";
          instruction.style.background = "rgba(0, 150, 0, 0.8)";
        }
      }
    </script>
  </body>
</html>
