<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
  <title>Prueba Cámara — AR</title>
  <style>
    html,body {
      height:100%;
      margin:0;
      background:#000;
      color:#fff;
      font-family:system-ui,Arial;
    }
    #app {
      width:100%;
      height:100%;
      position:relative;
    }
    video#cam {
      width:100%;
      height:100%;
      object-fit:cover;
      transform: none;
      display:none; /* oculto hasta que inicie */
    }
    #overlay {
      position:absolute; inset:0;
      display:flex; flex-direction:column;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,0.7);
      z-index:10;
      gap:12px;
      text-align:center;
      padding:20px;
    }
    button.cta {
      background:#ff3b30;
      color:#fff;
      border:none;
      padding:14px 20px;
      border-radius:10px;
      font-size:18px;
      cursor:pointer;
    }
    #small {
      position:absolute; left:8px; bottom:8px;
      font-size:12px; color:#ddd;
    }
  </style>
</head>
<body>
  <div id="app">
    <video id="cam" playsinline autoplay muted></video>

    <div id="overlay">
      <div id="msg">
        Para iniciar la experiencia, permite el uso de la cámara.<br>
        Pulsa el botón para abrir el permiso.
      </div>
      <button id="btnStart" class="cta">Iniciar cámara</button>
      <div style="font-size:12px; opacity:0.9; margin-top:6px;">
        Si el permiso ya fue negado, revisa ajustes del navegador.
      </div>
    </div>

    <div id="small">Usa Chrome (Android) o Safari (iOS) y asegúrate de estar en HTTPS.</div>
  </div>

  <script>
    const btn = document.getElementById('btnStart');
    const overlay = document.getElementById('overlay');
    const video = document.getElementById('cam');
    const msg = document.getElementById('msg');

    async function startCamera() {
      try {
        let stream = null;
        try {
          // Preferir cámara trasera
          stream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: { ideal: "environment" } }
          });
        } catch (err) {
          // Fallback a cualquier cámara
          stream = await navigator.mediaDevices.getUserMedia({ video: true });
        }

        video.srcObject = stream;
        await video.play().catch(()=>{});
        video.style.display = 'block';
        overlay.style.display = 'none';
      } catch (err) {
        console.error("Error al acceder a la cámara:", err);
        if (err.name === 'NotAllowedError') {
          msg.innerText = "Acceso denegado. Habilita la cámara en ajustes del navegador.";
        } else if (err.name === 'NotFoundError') {
          msg.innerText = "No se encontró cámara disponible en este dispositivo.";
        } else {
          msg.innerText = "No se pudo abrir la cámara. Prueba otro navegador (Chrome/Firefox/Safari).";
        }
      }
    }

    btn.addEventListener('click', startCamera);

    // Auto-inicio si ya hay permiso concedido
    window.addEventListener('load', async () => {
      if (navigator.permissions) {
        try {
          const p = await navigator.permissions.query({ name: 'camera' });
          if (p.state === 'granted') {
            startCamera();
          }
        } catch(e){}
      }
    });
  </script>
</body>
</html>
