<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Entre Hebras y Ausencias</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <!-- Librerías necesarias -->
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.4.2/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    video { display: none; } /* ocultar los controles de los <video> */
  </style>
</head>
<body>
  <!-- Escena con AR -->
  <a-scene
    mindar-image="imageTargetSrc: ./targets/cuadros.mind;"
    color-space="sRGB"
    renderer="colorManagement: true, physicallyCorrectLights"
    vr-mode-ui="enabled: false"
    device-orientation-permission-ui="enabled: true"
  >

    <a-assets>
      <!-- Videos -->
      <video id="videoVictima" src="./videos/victima.mp4" preload="auto" crossorigin="anonymous"></video>
      <video id="videoAgresor" src="./videos/agresor.mp4" preload="auto" crossorigin="anonymous"></video>
      <video id="videoTestigo" src="./videos/testigo.mp4" preload="auto" crossorigin="anonymous"></video>

      <!-- Modelo GLB -->
      <a-asset-item id="poseFinal" src="./models/pose_final_cuadro.glb"></a-asset-item>
    </a-assets>

    <!-- Target víctima -->
    <a-entity mindar-image-target="targetIndex: 0">
      <a-video id="planeVictima" src="#videoVictima" width="1.5" height="1" position="0 0 0"></a-video>
      <!-- Modelo 3D solo en víctima -->
      <a-gltf-model id="poseFinalModel" src="#poseFinal" position="0 -0.3 0.1" scale="0.5 0.5 0.5" rotation="0 180 0" visible="false"></a-gltf-model>
    </a-entity>

    <!-- Target agresor -->
    <a-entity mindar-image-target="targetIndex: 1">
      <a-video id="planeAgresor" src="#videoAgresor" width="1.5" height="1" position="0 0 0"></a-video>
    </a-entity>

    <!-- Target testigo -->
    <a-entity mindar-image-target="targetIndex: 2">
      <a-video id="planeTestigo" src="#videoTestigo" width="1.5" height="1" position="0 0 0"></a-video>
    </a-entity>

    <a-camera position="0 0 0"></a-camera>
  </a-scene>

  <script>
    // Obtener videos y modelo
    const videoVictima = document.getElementById("videoVictima");
    const videoAgresor = document.getElementById("videoAgresor");
    const videoTestigo = document.getElementById("videoTestigo");
    const poseFinalModel = document.getElementById("poseFinalModel");

    // Asegurar que se inicien los videos con interacción (limitación móvil)
    document.body.addEventListener("click", () => {
      videoVictima.play();
      videoAgresor.play();
      videoTestigo.play();
    }, { once: true });

    // Cuando termine el video de víctima, mostrar el modelo 3D
    videoVictima.addEventListener("ended", () => {
      poseFinalModel.setAttribute("visible", "true");
    });
  </script>
</body>
</html>
