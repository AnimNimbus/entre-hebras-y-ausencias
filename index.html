<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Videos</title>
  <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    #msg { 
      position: absolute; top: 12px; left: 50%; 
      transform: translateX(-50%); 
      background: rgba(0,0,0,0.6); color: #fff; 
      padding: 6px 12px; border-radius: 6px;
      font-family: system-ui, sans-serif;
    }
  </style>
</head>
<body>
  <div id="msg">Junta los 3 cuadros</div>

  <a-scene mindar-image="imageTargetSrc: ./targets/victima.mind, ./targets/agresor.mind, ./targets/testigo.mind;" 
           vr-mode-ui="enabled: false" 
           device-orientation-permission-ui="enabled: false">
    
    <a-assets>
      <video id="videoVictima" src="./videos/victima.mp4" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline></video>
      <video id="videoAgresor" src="./videos/agresor.mp4" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline></video>
      <video id="videoTestigo" src="./videos/testigo.mp4" preload="auto" crossorigin="anonymous" playsinline webkit-playsinline></video>
    </a-assets>

    <!-- Cuadro Victima -->
    <a-entity mindar-image-target="targetIndex: 0">
      <a-plane id="planeVictima" src="#videoVictima" position="0 0 0" height="0.7" width="1" visible="false"></a-plane>
    </a-entity>

    <!-- Cuadro Agresor -->
    <a-entity mindar-image-target="targetIndex: 1">
      <a-plane id="planeAgresor" src="#videoAgresor" position="0 0 0" height="0.7" width="1" visible="false"></a-plane>
    </a-entity>

    <!-- Cuadro Testigo -->
    <a-entity mindar-image-target="targetIndex: 2">
      <a-plane id="planeTestigo" src="#videoTestigo" position="0 0 0" height="0.7" width="1" visible="false"></a-plane>
    </a-entity>

    <a-camera position="0 0 0"></a-camera>
  </a-scene>

  <script>
    const videos = {
      0: document.querySelector("#videoVictima"),
      1: document.querySelector("#videoAgresor"),
      2: document.querySelector("#videoTestigo")
    };

    const planes = {
      0: document.querySelector("#planeVictima"),
      1: document.querySelector("#planeAgresor"),
      2: document.querySelector("#planeTestigo")
    };

    let visibles = {0:false, 1:false, 2:false};

    document.querySelector("a-scene").addEventListener("targetFound", e => {
      const idx = e.detail.targetIndex;
      visibles[idx] = true;

      // si los 3 están visibles, arrancamos sincronizados
      if (visibles[0] && visibles[1] && visibles[2]) {
        Object.values(planes).forEach(p => p.setAttribute("visible", "true"));
        Object.values(videos).forEach(v => {
          v.currentTime = 0;
          v.play();
        });
        document.getElementById("msg").innerText = "¡Activado!";
      }
    });

    document.querySelector("a-scene").addEventListener("targetLost", e => {
      const idx = e.detail.targetIndex;
      visibles[idx] = false;
    });
  </script>
</body>
</html>
